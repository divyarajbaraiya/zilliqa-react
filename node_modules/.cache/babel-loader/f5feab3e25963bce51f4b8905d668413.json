{"ast":null,"code":"var _jsxFileName = \"/home/webelight1/Documents/Zilliqa/dev-portal-examples/hello-world/src/App.js\";\nimport React from 'react';\nimport './App.css';\n\nconst {\n  BN,\n  Long,\n  bytes,\n  units\n} = require('@zilliqa-js/util');\n\nconst {\n  toBech32Address\n} = require('@zilliqa-js/crypto');\n\nconst {\n  Zilliqa\n} = require('@zilliqa-js/zilliqa');\n\nconst {\n  StatusType,\n  MessageType\n} = require('@zilliqa-js/subscriptions');\n\nexport default class App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      contractAddress: '',\n      setHelloValue: '',\n      welcomeMsg: ''\n    };\n    this.handleAddressChange = this.handleAddressChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleHelloChange = this.handleHelloChange.bind(this);\n    this.setHello = this.setHello.bind(this);\n    this.getHello = this.getHello.bind(this);\n    this.connectZilpay = this.connectZilpay.bind(this);\n  }\n\n  componentDidMount() {}\n\n  handleAddressChange(event) {\n    this.setState({\n      contractAddress: event.target.value\n    });\n  }\n\n  handleSubmit() {\n    localStorage.setItem(\"contract_address\", this.state.contractAddress);\n  }\n\n  handleHelloChange(event) {\n    this.setState({\n      setHelloValue: event.target.value\n    });\n  }\n\n  async setHello() {\n    if (window.zilPay.wallet.isEnable) {\n      this.updateWelcomeMsg();\n    } else {\n      const isConnect = await window.zilPay.wallet.connect();\n\n      if (isConnect) {\n        this.updateWelcomeMsg();\n      } else {\n        alert(\"Not able to call setHello as transaction is rejected\");\n      }\n    }\n  }\n\n  async updateWelcomeMsg() {\n    const zilliqa = window.zilPay;\n    let setHelloValue = this.state.setHelloValue;\n    let contractAddress = localStorage.getItem(\"contract_address\");\n    const CHAIN_ID = 333;\n    const MSG_VERSION = 1;\n    const VERSION = bytes.pack(CHAIN_ID, MSG_VERSION);\n    const myGasPrice = units.toQa('2000', units.Units.Li); // Gas Price that will be used by all transactions\n\n    contractAddress = contractAddress.substring(2);\n    const ftAddr = toBech32Address(contractAddress);\n\n    try {\n      const contract = zilliqa.contracts.at(ftAddr);\n      const callTx = await contract.call('setHello', [{\n        vname: 'msg',\n        type: 'String',\n        value: setHelloValue\n      }], {\n        // amount, gasPrice and gasLimit must be explicitly provided\n        version: VERSION,\n        amount: new BN(0),\n        gasPrice: myGasPrice,\n        gasLimit: Long.fromNumber(10000)\n      });\n    } catch (err) {\n      console.log(err);\n    }\n  }\n\n  async getHello() {\n    if (window.zilPay.wallet.isEnable) {\n      this.getWelcomeMsg();\n    } else {\n      const isConnect = await window.zilPay.wallet.connect();\n\n      if (isConnect) {\n        this.getWelcomeMsg();\n      } else {\n        alert(\"Not able to call setHello as transaction is rejected\");\n      }\n    }\n  }\n\n  async getWelcomeMsg() {\n    const zilliqa = window.zilPay;\n    let contractAddress = localStorage.getItem(\"contract_address\");\n    const CHAIN_ID = 333;\n    const MSG_VERSION = 1;\n    const VERSION = bytes.pack(CHAIN_ID, MSG_VERSION);\n    const myGasPrice = units.toQa('2000', units.Units.Li); // Gas Price that will be used by all transactions\n    // contractAddress = contractAddress.substring(2);\n\n    const ftAddr = toBech32Address(contractAddress);\n\n    try {\n      const contract = zilliqa.contracts.at(ftAddr);\n      const callTx = await contract.call('getHello', [], {\n        // amount, gasPrice and gasLimit must be explicitly provided\n        version: VERSION,\n        amount: new BN(0),\n        gasPrice: myGasPrice,\n        gasLimit: Long.fromNumber(10000)\n      });\n      console.log(callTx, \"callTx\");\n      console.log(JSON.stringify(callTx.TranID));\n      this.eventLogSubscription();\n    } catch (err) {\n      console.log(err);\n    }\n  } // Code that listens to websocket and updates welcome message when getHello() gets called.\n\n\n  async eventLogSubscription() {\n    const zilliqa = new Zilliqa('https://dev-api.zilliqa.com');\n    const subscriber = zilliqa.subscriptionBuilder.buildEventLogSubscriptions('wss://dev-ws.zilliqa.com', {\n      // smart contract address you want to listen on  \n      addresses: [localStorage.getItem(\"contract_address\")]\n    });\n    subscriber.emitter.on(StatusType.SUBSCRIBE_EVENT_LOG, event => {\n      // if subscribe success, it will echo the subscription info\n      console.log('get SubscribeEventLog echo : ', event);\n    });\n    subscriber.emitter.on(MessageType.EVENT_LOG, event => {\n      console.log('get new event log: ', JSON.stringify(event)); // updating the welcome msg when a new event log is received related to getHello() transition\n\n      if (event.hasOwnProperty(\"value\")) {\n        if (event.value[0].event_logs[0]._eventname == \"getHello()\") {\n          let welcomeMsg = event.value[0].event_logs[0].params[0].value;\n          this.setState({\n            welcomeMsg: welcomeMsg\n          });\n          console.log(\"welcomeMsg\", welcomeMsg);\n        }\n      }\n    });\n    await subscriber.start();\n  }\n\n  async connectZilpay() {\n    try {\n      await window.zilPay.wallet.connect();\n\n      if (window.zilPay.wallet.isConnect) {\n        localStorage.setItem(\"zilpay_connect\", true);\n        window.location.reload(false);\n      } else {\n        alert(\"Zilpay connection failed, try again...\");\n      }\n    } catch (error) {}\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }\n    }, \" \", `Current Contract Address : ${localStorage.getItem(\"contract_address\")}`, \" \"), /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }\n    }, \"Update Contract Address\"), /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 9\n      }\n    }, \"New Address \", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 23\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      onChange: this.handleAddressChange,\n      size: \"70\",\n      placeholder: \"Format: 0x47d9CEea9a2DA23dc6b2D96A16F7Fbf884580665\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"submit\",\n      value: \"Submit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 7\n      }\n    }, \" Hello World Contract Transitions\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 51\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 9\n      }\n    }, \"Set Hello\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      onChange: this.handleHelloChange,\n      size: \"30\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.setHello,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 9\n      }\n    }, \"Set Hello\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 59\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 64\n      }\n    }), /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 9\n      }\n    }, \"Get Hello\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.getHello,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 9\n      }\n    }, \"Get Hello\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 59\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 64\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }\n    }, \" \", `Current Welcome Msg : ${this.state.welcomeMsg}`, \" \"), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 9\n      }\n    }), !localStorage.getItem(\"zilpay_connect\") && /*#__PURE__*/React.createElement(\"button\", {\n      onClick: this.connectZilpay,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 53\n      }\n    }, \"Connect Zilpay\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 14\n      }\n    }));\n  }\n\n}","map":{"version":3,"sources":["/home/webelight1/Documents/Zilliqa/dev-portal-examples/hello-world/src/App.js"],"names":["React","BN","Long","bytes","units","require","toBech32Address","Zilliqa","StatusType","MessageType","App","Component","constructor","props","state","contractAddress","setHelloValue","welcomeMsg","handleAddressChange","bind","handleSubmit","handleHelloChange","setHello","getHello","connectZilpay","componentDidMount","event","setState","target","value","localStorage","setItem","window","zilPay","wallet","isEnable","updateWelcomeMsg","isConnect","connect","alert","zilliqa","getItem","CHAIN_ID","MSG_VERSION","VERSION","pack","myGasPrice","toQa","Units","Li","substring","ftAddr","contract","contracts","at","callTx","call","vname","type","version","amount","gasPrice","gasLimit","fromNumber","err","console","log","getWelcomeMsg","JSON","stringify","TranID","eventLogSubscription","subscriber","subscriptionBuilder","buildEventLogSubscriptions","addresses","emitter","on","SUBSCRIBE_EVENT_LOG","EVENT_LOG","hasOwnProperty","event_logs","_eventname","params","start","location","reload","error","render"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\nconst {BN, Long, bytes, units} = require('@zilliqa-js/util');\nconst {toBech32Address} = require('@zilliqa-js/crypto');\nconst { Zilliqa } = require('@zilliqa-js/zilliqa');\nconst { StatusType, MessageType } = require('@zilliqa-js/subscriptions');\n\nexport default class App extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      contractAddress: '',\n      setHelloValue: '',\n      welcomeMsg:''\n    };\n\n    this.handleAddressChange = this.handleAddressChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n    this.handleHelloChange = this.handleHelloChange.bind(this);\n    this.setHello = this.setHello.bind(this);\n    this.getHello = this.getHello.bind(this);\n    this.connectZilpay = this.connectZilpay.bind(this);\n  }\n\n  componentDidMount() {\n  }\n\n\n  handleAddressChange(event) {\n    this.setState({contractAddress: event.target.value});\n  }\n\n  handleSubmit() {\n    localStorage.setItem(\"contract_address\", this.state.contractAddress);\n  }\n\n  handleHelloChange(event) {\n    this.setState({setHelloValue: event.target.value});\n  }\n\n  async setHello(){\n    if(window.zilPay.wallet.isEnable){\n      this.updateWelcomeMsg();\n    }\n    else{\n      const isConnect = await window.zilPay.wallet.connect();\n      if (isConnect) {\n        this.updateWelcomeMsg();\n      } else {\n      alert(\"Not able to call setHello as transaction is rejected\");\n      }\n    } \n  }\n\n  async updateWelcomeMsg(){\n    const zilliqa = window.zilPay;\n    let setHelloValue = this.state.setHelloValue;\n    let contractAddress = localStorage.getItem(\"contract_address\");\n    const CHAIN_ID = 333;\n    const MSG_VERSION = 1;\n    const VERSION = bytes.pack(CHAIN_ID, MSG_VERSION);   \n    const myGasPrice = units.toQa('2000', units.Units.Li); // Gas Price that will be used by all transactions\n    contractAddress = contractAddress.substring(2);\n    const ftAddr = toBech32Address(contractAddress);\n    try {\n        const contract = zilliqa.contracts.at(ftAddr);\n        const callTx = await contract.call(\n            'setHello',\n            [\n                {\n                    vname: 'msg',\n                    type: 'String',\n                    value: setHelloValue\n                }\n            ],\n            {\n                // amount, gasPrice and gasLimit must be explicitly provided\n                version: VERSION,\n                amount: new BN(0),\n                gasPrice: myGasPrice,\n                gasLimit: Long.fromNumber(10000),\n            }\n        );\n  \n    } catch (err) {\n        console.log(err);\n    }\n  }\n\n  async getHello(){\n    if(window.zilPay.wallet.isEnable){\n      this.getWelcomeMsg();\n    }\n    else{\n      const isConnect = await window.zilPay.wallet.connect();\n      if (isConnect) {\n        this.getWelcomeMsg();\n      } else {\n        alert(\"Not able to call setHello as transaction is rejected\")\n      }\n    } \n  }\n\n  async getWelcomeMsg(){\n    \n    const zilliqa = window.zilPay;\n    let contractAddress = localStorage.getItem(\"contract_address\");\n    const CHAIN_ID = 333;\n    const MSG_VERSION = 1;\n    const VERSION = bytes.pack(CHAIN_ID, MSG_VERSION);   \n    const myGasPrice = units.toQa('2000', units.Units.Li); // Gas Price that will be used by all transactions\n    // contractAddress = contractAddress.substring(2);\n    const ftAddr = toBech32Address(contractAddress);\n    try {\n        const contract = zilliqa.contracts.at(ftAddr);\n        const callTx = await contract.call(\n            'getHello',\n            [\n            ],\n            {\n                // amount, gasPrice and gasLimit must be explicitly provided\n                version: VERSION,\n                amount: new BN(0),\n                gasPrice: myGasPrice,\n                gasLimit: Long.fromNumber(10000),\n            }\n        );\n        console.log(callTx, \"callTx\");\n        console.log(JSON.stringify(callTx.TranID));\n        this.eventLogSubscription();  \n    } catch (err) {\n        console.log(err);\n    }\n\n  }\n  // Code that listens to websocket and updates welcome message when getHello() gets called.\n  async eventLogSubscription() {\n    const zilliqa = new Zilliqa('https://dev-api.zilliqa.com');\n    const subscriber = zilliqa.subscriptionBuilder.buildEventLogSubscriptions(\n      'wss://dev-ws.zilliqa.com',\n      {\n        // smart contract address you want to listen on  \n        addresses: [localStorage.getItem(\"contract_address\")],\n      },\n    );\n    \n    subscriber.emitter.on(StatusType.SUBSCRIBE_EVENT_LOG, (event) => {\n      // if subscribe success, it will echo the subscription info\n      console.log('get SubscribeEventLog echo : ', event);\n    });\n    \n    subscriber.emitter.on(MessageType.EVENT_LOG, (event) => {\n      console.log('get new event log: ', JSON.stringify(event));\n      // updating the welcome msg when a new event log is received related to getHello() transition\n      if(event.hasOwnProperty(\"value\")){\n        if(event.value[0].event_logs[0]._eventname ==\"getHello()\"){\n          let welcomeMsg = event.value[0].event_logs[0].params[0].value;\n          this.setState({welcomeMsg: welcomeMsg});\n          console.log(\"welcomeMsg\", welcomeMsg);\n        }\n      }\n    });  \n    await subscriber.start();\n  }\n\n  async connectZilpay(){\n    try {\n      await window.zilPay.wallet.connect();\n      if(window.zilPay.wallet.isConnect){\n        localStorage.setItem(\"zilpay_connect\", true);\n        window.location.reload(false);\n      } else {\n      alert(\"Zilpay connection failed, try again...\")\n    }\n    } catch (error) {}\n  }  \n  render(){\n    return (\n      <div className=\"App\">\n        <div> {`Current Contract Address : ${localStorage.getItem(\"contract_address\")}`} </div>\n        <h3>Update Contract Address</h3>\n        <form onSubmit={this.handleSubmit}>\n        <label>\n          New Address <br/>\n          <input type=\"text\" onChange={this.handleAddressChange} size=\"70\" placeholder=\"Format: 0x47d9CEea9a2DA23dc6b2D96A16F7Fbf884580665\"/>\n        </label><br/>\n        <input type=\"submit\" value=\"Submit\" />\n        <hr></hr>\n      </form>\n      <div> Hello World Contract Transitions</div><br/>\n\n        <label>\n          Set Hello \n          </label><br/>\n          <input type=\"text\" onChange={this.handleHelloChange} size=\"30\"/>\n        <br/>\n        <button onClick={this.setHello}>Set Hello</button><br/><br/>\n        <label>\n          Get Hello\n        </label><br/>\n        <button onClick={this.getHello}>Get Hello</button><br/><br/>\n        <div> {`Current Welcome Msg : ${this.state.welcomeMsg}`} </div>\n        <hr></hr>\n        {!localStorage.getItem(\"zilpay_connect\") && <button onClick={this.connectZilpay}>Connect Zilpay</button>}\n        <br/><br/>\n      </div>\n      \n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}